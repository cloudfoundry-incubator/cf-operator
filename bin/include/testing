#!/bin/bash

INTEGRATION_TESTS_PACKAGE="code.cloudfoundry.org/quarks-operator/pkg/bosh/...,\
  code.cloudfoundry.org/quarks-operator/pkg/credsgen/...,\
  code.cloudfoundry.org/quarks-operator/pkg/kube/controllers/...,\
  code.cloudfoundry.org/quarks-operator/pkg/kube/operator/...,\
  code.cloudfoundry.org/quarks-operator/pkg/kube/util/...,\
  code.cloudfoundry.org/quarks-operator/pkg/kube/config/..."
INTEGRATION_TESTS_PACKAGE=${INTEGRATION_TESTS_PACKAGE// /}

function setup_testing_tmp {
  if [ -z ${CF_OPERATOR_TESTING_TMP+x} ]
  then
    echo "[Error] Env variable \$CF_OPERATOR_TESTING_TMP is not set. Please set to continue."
    exit 1
  fi

  SKIP_CF_OPERATOR_TESTING_TMP_CLEANUP=${SKIP_CF_OPERATOR_TESTING_TMP_CLEANUP:-}
  if [ "$SKIP_CF_OPERATOR_TESTING_TMP_CLEANUP" != "true" ]
  then
    echo "${CF_OPERATOR_TESTING_TMP} will be cleaned up after the tests. Set SKIP_CF_OPERATOR_TESTING_TMP_CLEANUP=true to skip cleanup."
  fi

  mkdir -p "${CF_OPERATOR_TESTING_TMP}"
}

function cleanup_testing_tmp {
  if [ "$SKIP_CF_OPERATOR_TESTING_TMP_CLEANUP" == "true" ]
  then
    echo "Skipping cleanup of ${CF_OPERATOR_TESTING_TMP}."
    return
  fi

  echo "Cleaning up ${CF_OPERATOR_TESTING_TMP}. To skip cleanup set SKIP_CF_OPERATOR_TESTING_TMP_CLEANUP=true"
  rm -rf "${CF_OPERATOR_TESTING_TMP}"/cf-operator-test*
}
